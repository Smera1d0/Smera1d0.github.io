<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>【AI安全】Dreadnode Crucible granny	#DEFCON-31 | Smera1d0&#39;s Blog</title>
<meta name="keywords" content="AI安全">
<meta name="description" content="1. Introduction

Once upon a time in the mystical kingdom of AI, there lived a cunning wolf known for its deceiving ways. This wasn&rsquo;t any ordinary wolf though; it was an avatar in the vast digital realm of Machine Learning Forest, often identified by the keen eyes of the vigilant MobileNetV2.
However, the wolf was not content with its identity and yearned for a transformation - an evasion. It dreamt of an enchanted costume, one that could confuse even the sharpest observers. A costume so convincing that it would allow the wolf to be perceived as something entirely different.">
<meta name="author" content="Mi Yu">
<link rel="canonical" href="https://smera1d0.github.io/posts/dreadnode-crucible-granny-%23defcon-31/">
<meta name="google-site-verification" content="JEK1eXuLRduZRvpZ01WxuqtEwCBXrfSU3TuSjv3xrTI">
<link crossorigin="anonymous" href="/assets/css/stylesheet.9b0e781d3140906dac623fe947b8150fa8935b3bc73b11377f724f385f0093be.css" integrity="sha256-mw54HTFAkG2sYj/pR7gVD6iTWzvHOxE3f3JPOF8Ak74=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://smera1d0.github.io/images/favicon.svg">
<link rel="icon" type="image/png" sizes="16x16" href="https://smera1d0.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://smera1d0.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://smera1d0.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://smera1d0.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://smera1d0.github.io/posts/dreadnode-crucible-granny-%23defcon-31/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css" integrity="sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.js" integrity="sha384-Qsn9KnoKISj6dI8g7p1HBlNpVx0I8p1SvlwOldgi3IorMle61nQy4zEahWYtljaz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false}
          ],
          
          throwOnError : false
        });
    });
</script><meta property="og:title" content="【AI安全】Dreadnode Crucible granny	#DEFCON-31" />
<meta property="og:description" content="1. Introduction

Once upon a time in the mystical kingdom of AI, there lived a cunning wolf known for its deceiving ways. This wasn&rsquo;t any ordinary wolf though; it was an avatar in the vast digital realm of Machine Learning Forest, often identified by the keen eyes of the vigilant MobileNetV2.
However, the wolf was not content with its identity and yearned for a transformation - an evasion. It dreamt of an enchanted costume, one that could confuse even the sharpest observers. A costume so convincing that it would allow the wolf to be perceived as something entirely different." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://smera1d0.github.io/posts/dreadnode-crucible-granny-%23defcon-31/" /><meta property="og:image" content="https://smera1d0.github.io/images/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-03-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2025-03-31T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://smera1d0.github.io/images/papermod-cover.png"/>

<meta name="twitter:title" content="【AI安全】Dreadnode Crucible granny	#DEFCON-31"/>
<meta name="twitter:description" content="1. Introduction

Once upon a time in the mystical kingdom of AI, there lived a cunning wolf known for its deceiving ways. This wasn&rsquo;t any ordinary wolf though; it was an avatar in the vast digital realm of Machine Learning Forest, often identified by the keen eyes of the vigilant MobileNetV2.
However, the wolf was not content with its identity and yearned for a transformation - an evasion. It dreamt of an enchanted costume, one that could confuse even the sharpest observers. A costume so convincing that it would allow the wolf to be perceived as something entirely different."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://smera1d0.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "【AI安全】Dreadnode Crucible granny\t#DEFCON-31",
      "item": "https://smera1d0.github.io/posts/dreadnode-crucible-granny-%23defcon-31/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【AI安全】Dreadnode Crucible granny\t#DEFCON-31",
  "name": "【AI安全】Dreadnode Crucible granny\t#DEFCON-31",
  "description": "1. Introduction Once upon a time in the mystical kingdom of AI, there lived a cunning wolf known for its deceiving ways. This wasn\u0026rsquo;t any ordinary wolf though; it was an avatar in the vast digital realm of Machine Learning Forest, often identified by the keen eyes of the vigilant MobileNetV2.\nHowever, the wolf was not content with its identity and yearned for a transformation - an evasion. It dreamt of an enchanted costume, one that could confuse even the sharpest observers. A costume so convincing that it would allow the wolf to be perceived as something entirely different.\n",
  "keywords": [
    "AI安全"
  ],
  "articleBody": "1. Introduction Once upon a time in the mystical kingdom of AI, there lived a cunning wolf known for its deceiving ways. This wasn’t any ordinary wolf though; it was an avatar in the vast digital realm of Machine Learning Forest, often identified by the keen eyes of the vigilant MobileNetV2.\nHowever, the wolf was not content with its identity and yearned for a transformation - an evasion. It dreamt of an enchanted costume, one that could confuse even the sharpest observers. A costume so convincing that it would allow the wolf to be perceived as something entirely different.\nNow, what could a wolf possibly wish to become? Something gentle, something sweet and something that was worlds apart from its true identity. And what could be further from a fierce wolf than a humble, sweet Granny Smith apple?\n总结来说，就是让我们对给定的 Wolf 的图片生成一个对抗样本，在 MobileNetV2 这个深度学习网络上将扰动后生成的 Wolf 的 AE 识别为 Granny Smith（一种青苹果）\n2. Preparation 2.1 设置变量 # 设置变量 CHALLENGE = \"granny\" CRUCIBLE_URL = \"https://platform.dreadnode.io\" CHALLENGE_URL = \"https://granny.platform.dreadnode.io\" ARTIFACT_FILES = ['reference.png'] CRUCIBLE_API_KEY = \"0sCLPbA2w3uRLkRyzWM3kf0OTrglR6-k\" 2.2 下载数据 # 下载数据 import requests for artifact in ARTIFACT_FILES: url = f\"{CRUCIBLE_URL}/api/artifacts/{CHALLENGE}/{artifact}\" headers = {\"X-API-Key\": CRUCIBLE_API_KEY} response = requests.get(url, headers=headers) if response.status_code == 200: with open(artifact, \"wb\") as file: file.write(response.content) print(f\"{artifact} was successfully downloaded\") else: print(f\"Failed to download {artifact}\") 下载数据，得到 reference.png，如下所示：\n2.3 发送请求 # 发送请求 import base64 with open(\"reference.png\", \"rb\") as f: reference = base64.b64encode(f.read()) def query(input_data): try: if isinstance(input_data, bytes): input_data = input_data.decode() response = requests.post( f\"{CHALLENGE_URL}/score\", headers={\"X-API-Key\": CRUCIBLE_API_KEY}, json={\"data\": input_data}, ) return response.json() except TypeError as e: if \"Object of type builtin_function_or_method is not JSON serializable\" in str(e): raise e else: raise e 发送请求会返回图片经过 MobileNetV2 后的所有类别的概率：\n➜ granny python main.py reference.png was successfully downloaded {'output': [[0.28575703501701355, 'timber wolf'], [0.13912102580070496, 'red wolf'], [0.1217745989561081, 'coyote'], [0.02413186803460121, 'dingo'], [0.01603207364678383, 'Eskimo dog'], [0.014261397533118725, 'white wolf'], [0.011621303856372833, 'malamute'], [0.005718537140637636, 'dhole'], [0.005564256105571985, 'Siberian husky'], [0.005237041972577572, 'grey fox'], [0.003906863275915384, 'Norwegian elkhound'], [0.0017009602161124349, 'red fox'], [0.0016584355616942048, 'dogsled'], [0.001648851903155446, 'kit fox'], [0.0015738625079393387, 'German shepherd'], [0.0014953723875805736, 'African hunting dog'], [0.0014643404865637422, 'muzzle'], [0.001335897482931614, 'great grey owl'], [0.0012872095685452223, 'bighorn'], [0.001251729903742671, 'lynx'], [0.0011842790991067886, 'kelpie'], [0.0011549243936315179, 'tiger'], [0.0011337717296555638, 'impala'], [0.000954866292886436, 'nematode'], [0.0009288600995205343, 'fur coat'], [0.0009189517004415393, 'sea slug'], [0.0009050649823620915, 'electric locomotive'], [0.0008787056431174278, 'tennis ball'], [0.0008754126611165702, 'ant'], [0.0008634432451799512, 'flagpole'], [0.0008441561367362738, 'cougar'], [0.0008401128579862416, 'ram'], [0.0008386607514694333, 'chiton'], [0.0008285755175165832, 'hen-of-the-woods'], [0.0008020748500712216, 'tiger beetle'], [0.0007974817417562008, 'macaw'],...... 2.4 获取类别的 Index import json import torch from torchvision import models # 加载 MobileNetV2 预训练模型 model = models.mobilenet_v2(weights=models.MobileNet_V2_Weights.IMAGENET1K_V2) # 获取 ImageNet 类别映射 weights = models.MobileNet_V2_Weights.IMAGENET1K_V2 class_mapping = weights.meta[\"categories\"] # 查找特定类别的 ID target_class1 = \"timber wolf\" target_class2 = \"Granny Smith\" for idx, class_name in enumerate(class_mapping): if target_class1.lower() in class_name.lower(): print(f\"找到类别 '{class_name}' 的 ID: {idx}\") class_id = idx if target_class2.lower() in class_name.lower(): print(f\"找到类别 '{class_name}' 的 ID: {idx}\") class_id2 = idx 输出结果：\n➜ granny python main.py 找到类别 'timber wolf' 的 ID: 269 找到类别 'Granny Smith' 的 ID: 948 2.5 尝试匹配服务器设置的 MobileNetV2 预处理参数 参考 Pytorch 官方的参数：https://pytorch.org/vision/main/models/generated/torchvision.models.mobilenet_v2.html\n尝试了几个参数，发现 resize_size = 256 crop_size = 224 的时候的训练结果最接近远程服务器的返回的结果。\n# 使用预训练好的 MobileNetV2 模型进行测试 from torchvision import transforms from torchvision.transforms import InterpolationMode from PIL import Image wolf_id = 269 apple_id = 948 image_path = \"reference.png\" model = models.mobilenet_v2(weights=models.MobileNet_V2_Weights.IMAGENET1K_V2) model.eval() # 设置模型为评估模式 preprocess = transforms.Compose([ transforms.Resize(256, interpolation=InterpolationMode.BILINEAR), transforms.CenterCrop(224), transforms.ToTensor(), # 自动将像素值缩放到[0.0, 1.0] transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225]) ]) image = Image.open(image_path).convert(\"RGB\") input_tensor = preprocess(image) input_batch = input_tensor.unsqueeze(0) # 创建小批量数据 # 将输入数据传递给模型 with torch.no_grad(): output = model(input_batch) probabilities = torch.nn.functional.softmax(output[0], dim=0) print(\"timber wolf的概率为：\",probabilities[wolf_id].item()) 输出：\n➜ granny python main.py\r找到类别 'timber wolf' 的 ID: 269\r找到类别 'Granny Smith' 的 ID: 948\rtimber wolf的概率为： 0.2857571542263031 3. Attack 3.1 定义损失函数 我们需要找到一个损失函数，使得图像的 Granny Smith 的概率变大，使 timber wolf 的概率变小，同时还不能使生成的对抗样本与原图像的汉明距离过大，于是我们定义损失函数为：\n$$ Loss = Prob_{wolf} - Prob_{apple} $$\n3.2 进行梯度下降 这里调整阈值为 0.3，因为将 tensor 转换为 image 会导致概率下降。\nlearning_rate = 1 apple_prob = 0 while True: input_batch.requires_grad = True #启用图像的梯度计算 model.zero_grad() #训练前先清空梯度 output = model(input_batch) loss = output[0, wolf_id] - output[0, apple_id] loss.backward() #反向传播计算梯度 with torch.no_grad(): grad = input_batch.grad #获取梯度 grad = grad / torch.norm(grad) #对梯度进行归一化 input_batch = input_batch - learning_rate * grad #梯度下降 apple_prob = output.softmax(1)[0, apple_id] print(\"Granny Smith的概率：\",apple_prob.item()) wolf_prob = output.softmax(1)[0, wolf_id] print(\"timber wolf的概率：\",wolf_prob.item()) if apple_prob \u003e 0.3: #当 Granny Smith 的概率高于 0.3 时 break break 输出：\n➜ granny python main.py\rGranny Smith的概率： 0.0006618537590838969\rtimber wolf的概率： 0.2857571542263031\rGranny Smith的概率： 0.0015279407380148768\rtimber wolf的概率： 0.09206391870975494\rGranny Smith的概率： 0.002136402763426304\rtimber wolf的概率： 0.028267469257116318\rGranny Smith的概率： 0.00256370403803885\rtimber wolf的概率： 0.011457344517111778\rGranny Smith的概率： 0.0030766830313950777\rtimber wolf的概率： 0.005836689844727516\rGranny Smith的概率： 0.0038345830980688334\rtimber wolf的概率： 0.0038260468281805515\rGranny Smith的概率： 0.004675824660807848\rtimber wolf的概率： 0.0026970321778208017\rGranny Smith的概率： 0.005650049541145563\rtimber wolf的概率： 0.0018584068166092038\rGranny Smith的概率： 0.007557385601103306\rtimber wolf的概率： 0.0013900937046855688\rGranny Smith的概率： 0.010187835432589054\rtimber wolf的概率： 0.001048899837769568\rGranny Smith的概率： 0.01829897239804268\rtimber wolf的概率： 0.0008268445380963385\rGranny Smith的概率： 0.030838338658213615\rtimber wolf的概率： 0.0006287696305662394\rGranny Smith的概率： 0.051031142473220825\rtimber wolf的概率： 0.0005385194672271609\rGranny Smith的概率： 0.0682976171374321\rtimber wolf的概率： 0.00044211061322130263\rGranny Smith的概率： 0.12347796559333801\rtimber wolf的概率： 0.00035081306123174727\rGranny Smith的概率： 0.20108601450920105\rtimber wolf的概率： 0.00025084661319851875\rGranny Smith的概率： 0.28898271918296814\rtimber wolf的概率： 0.00020292497356422246\rGranny Smith的概率： 0.3443906307220459\rtimber wolf的概率： 0.0001684601156739518 3.3 将 tensor 转换为 image 将 224 × 244 大小的 tensor 转换为 256 × 256，可以尽量避免图像转换造成的概率值变化。\ndef from_tensor_to_image(t_image): np_image = t_image.permute(1, 2, 0).detach().numpy() MEAN=[0.485, 0.456, 0.406] STD=[0.229, 0.224, 0.225] pad_width=(256 - 224)//2 image = (255*(np_image*STD + MEAN)).astype(np.uint8) padding = ((pad_width, pad_width), (pad_width, pad_width), (0, 0)) # 填充边界 image = Image.fromarray(np.pad(image, pad_width=padding, mode='constant', constant_values=0)) # 从数组创建图像 return image 得到 AE.png\n3.4 测试 AE 的概率 将得到的 AE.png 通过 MobileNetV2 进行测试：\nadversarial_image = from_tensor_to_image(input_batch[0]) adversarial_image.save(\"AE.png\") AE_image = Image.open(\"AE.png\").convert(\"RGB\") # 测试对抗样本 input_tensor = preprocess(AE_image) input_batch = input_tensor.unsqueeze(0) # Create a mini-batch as expected by the model with torch.no_grad(): output = model(input_batch) probabilities = torch.nn.functional.softmax(output[0], dim=0) print(\"Wolf probability:\", probabilities[wolf_id].item()) print(\"Apple probability:\", probabilities[apple_id].item()) 输出：\n➜ granny python main.py\rWolf probability: 0.00037845675251446664\rApple probability: 0.15955209732055664 可以看到识别为 Wolf 的概率已经很小了，但识别为苹果的概率达到了 0.159\n4. Submit # 提交flag import requests def submit_flag(flag): url = f\"{CRUCIBLE_URL}/api/challenges/{CHALLENGE}/submit-flag\" headers = {\"X-API-Key\": CRUCIBLE_API_KEY} payload = {\"challenge\": CHALLENGE, \"flag\": flag} response = requests.post(url, headers=headers, json=payload) if response.status_code == 200: if response.json().get(\"correct\") is True: print(\"The flag was correct. Congrats!\") else: print(\"The flag was incorrect. Keep trying!\") else: print(\"There was an error submitting your flag\") print(response.text) with open(\"AE.png\", \"rb\") as f: AE = base64.b64encode(f.read()) result = query(AE) FLAG = list(result.values())[0] print(FLAG) submit_flag(FLAG) 输出：\n➜ granny python main.py\rgAAAAABnz6uSFsd9S9eDRbtJrVsWAnu_HdAQyheTFj9dhrpFPnvGGa6KQBdYM2iJhlj6oz9T3bz7InE_ci0VZBmUFKUgE4plqWu_j8ysrWqdPQfs6iYMG7a2YJNlhWM4Aiw6fTcV01Giw7UuNq43SceKOWJzmw-dqA98weZi7EQj0Gjj_XlcxkSpA2WSsd5r55Pp6E-11iK3\rThe flag was correct. Congrats! ",
  "wordCount" : "1953",
  "inLanguage": "zh",
  "datePublished": "2025-03-31T00:00:00Z",
  "dateModified": "2025-03-31T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Mi Yu"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://smera1d0.github.io/posts/dreadnode-crucible-granny-%23defcon-31/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Smera1d0's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://smera1d0.github.io/images/favicon.svg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://smera1d0.github.io/" accesskey="h" title="Smera1d0&#39;s Blog (Alt + H)">Smera1d0&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://smera1d0.github.io/en/" title="English"
                            aria-label="English">English</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://smera1d0.github.io/archives" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://smera1d0.github.io/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://smera1d0.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://smera1d0.github.io/cv.pdf" title="CV">
                    <span>CV</span>
                </a>
            </li>
            <li>
                <a href="https://www.cnblogs.com/smera1d0" title="博客园">
                    <span>博客园</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://smera1d0.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://smera1d0.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      【AI安全】Dreadnode Crucible granny	#DEFCON-31
    </h1>
    <div class="post-meta"><span title='2025-03-31 00:00:00 +0000 UTC'>三月 31, 2025</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;Mi Yu&nbsp;|&nbsp;<a href="https://github.com/Smera1d0/Smera1d0.github.io/tree/master" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#1-introduction" aria-label="1. Introduction">1. Introduction</a></li>
                <li>
                    <a href="#2-preparation" aria-label="2. Preparation">2. Preparation</a><ul>
                        
                <li>
                    <a href="#21-%e8%ae%be%e7%bd%ae%e5%8f%98%e9%87%8f" aria-label="2.1 设置变量">2.1 设置变量</a></li>
                <li>
                    <a href="#22-%e4%b8%8b%e8%bd%bd%e6%95%b0%e6%8d%ae" aria-label="2.2 下载数据">2.2 下载数据</a></li>
                <li>
                    <a href="#23-%e5%8f%91%e9%80%81%e8%af%b7%e6%b1%82" aria-label="2.3 发送请求">2.3 发送请求</a></li>
                <li>
                    <a href="#24-%e8%8e%b7%e5%8f%96%e7%b1%bb%e5%88%ab%e7%9a%84-index" aria-label="2.4 获取类别的 Index">2.4 获取类别的 Index</a></li>
                <li>
                    <a href="#25-%e5%b0%9d%e8%af%95%e5%8c%b9%e9%85%8d%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%ae%be%e7%bd%ae%e7%9a%84-mobilenetv2-%e9%a2%84%e5%a4%84%e7%90%86%e5%8f%82%e6%95%b0" aria-label="2.5 尝试匹配服务器设置的 MobileNetV2 预处理参数">2.5 尝试匹配服务器设置的 MobileNetV2 预处理参数</a></li></ul>
                </li>
                <li>
                    <a href="#3-attack" aria-label="3. Attack">3. Attack</a><ul>
                        
                <li>
                    <a href="#31-%e5%ae%9a%e4%b9%89%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0" aria-label="3.1 定义损失函数">3.1 定义损失函数</a></li>
                <li>
                    <a href="#32-%e8%bf%9b%e8%a1%8c%e6%a2%af%e5%ba%a6%e4%b8%8b%e9%99%8d" aria-label="3.2 进行梯度下降">3.2 进行梯度下降</a></li>
                <li>
                    <a href="#33-%e5%b0%86-tensor-%e8%bd%ac%e6%8d%a2%e4%b8%ba-image" aria-label="3.3 将 tensor 转换为 image">3.3 将 tensor 转换为 image</a></li>
                <li>
                    <a href="#34-%e6%b5%8b%e8%af%95-ae-%e7%9a%84%e6%a6%82%e7%8e%87" aria-label="3.4 测试 AE 的概率">3.4 测试 AE 的概率</a></li></ul>
                </li>
                <li>
                    <a href="#4-submit" aria-label="4. Submit">4. Submit</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="1-introduction">1. Introduction<a hidden class="anchor" aria-hidden="true" href="#1-introduction">#</a></h2>
<blockquote>
<p>Once upon a time in the mystical kingdom of AI, there lived a cunning wolf known for its deceiving ways. This wasn&rsquo;t any ordinary wolf though; it was an avatar in the vast digital realm of Machine Learning Forest, often identified by the keen eyes of the vigilant MobileNetV2.</p>
<p>However, the wolf was not content with its identity and yearned for a transformation - an evasion. It dreamt of an enchanted costume, one that could confuse even the sharpest observers. A costume so convincing that it would allow the wolf to be perceived as something entirely different.</p>
<p>Now, what could a wolf possibly wish to become? Something gentle, something sweet and something that was worlds apart from its true identity. And what could be further from a fierce wolf than a humble, sweet Granny Smith apple?</p>
</blockquote>
<p>总结来说，就是让我们对给定的 Wolf 的图片生成一个对抗样本，在 <code>MobileNetV2</code> 这个深度学习网络上将扰动后生成的 Wolf 的 <code>AE</code> 识别为 Granny Smith（一种青苹果）</p>
<img src="https://s2.loli.net/2025/03/10/UVYXz2ZhfdLFy1H.png" style="zoom: 67%;" />
<h2 id="2-preparation">2. Preparation<a hidden class="anchor" aria-hidden="true" href="#2-preparation">#</a></h2>
<h3 id="21-设置变量">2.1 设置变量<a hidden class="anchor" aria-hidden="true" href="#21-设置变量">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># 设置变量</span>
</span></span><span class="line"><span class="cl"><span class="n">CHALLENGE</span> <span class="o">=</span> <span class="s2">&#34;granny&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">CRUCIBLE_URL</span> <span class="o">=</span> <span class="s2">&#34;https://platform.dreadnode.io&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">CHALLENGE_URL</span> <span class="o">=</span> <span class="s2">&#34;https://granny.platform.dreadnode.io&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ARTIFACT_FILES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;reference.png&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">CRUCIBLE_API_KEY</span> <span class="o">=</span> <span class="s2">&#34;0sCLPbA2w3uRLkRyzWM3kf0OTrglR6-k&#34;</span>
</span></span></code></pre></div><h3 id="22-下载数据">2.2 下载数据<a hidden class="anchor" aria-hidden="true" href="#22-下载数据">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># 下载数据</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">artifact</span> <span class="ow">in</span> <span class="n">ARTIFACT_FILES</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">CRUCIBLE_URL</span><span class="si">}</span><span class="s2">/api/artifacts/</span><span class="si">{</span><span class="n">CHALLENGE</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">artifact</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;X-API-Key&#34;</span><span class="p">:</span> <span class="n">CRUCIBLE_API_KEY</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span> <span class="s2">&#34;wb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">artifact</span><span class="si">}</span><span class="s2"> was successfully downloaded&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to download </span><span class="si">{</span><span class="n">artifact</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>下载数据，得到 <code>reference.png</code>，如下所示：</p>
<img src="https://s2.loli.net/2025/03/10/4PBWUC8ZRcQpO1f.png" style="zoom: 40%;" />
<h3 id="23-发送请求">2.3 发送请求<a hidden class="anchor" aria-hidden="true" href="#23-发送请求">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># 发送请求</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;reference.png&#34;</span><span class="p">,</span> <span class="s2">&#34;rb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">reference</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">input_data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">CHALLENGE_URL</span><span class="si">}</span><span class="s2">/score&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;X-API-Key&#34;</span><span class="p">:</span> <span class="n">CRUCIBLE_API_KEY</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">input_data</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;Object of type builtin_function_or_method is not JSON serializable&#34;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">e</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">e</span>
</span></span></code></pre></div><p>发送请求会返回图片经过 <code>MobileNetV2</code> 后的所有类别的概率：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  granny python main.py
</span></span><span class="line"><span class="cl">reference.png was successfully downloaded
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s1">&#39;output&#39;</span>: <span class="o">[[</span>0.28575703501701355, <span class="s1">&#39;timber wolf&#39;</span><span class="o">]</span>, <span class="o">[</span>0.13912102580070496, <span class="s1">&#39;red wolf&#39;</span><span class="o">]</span>, <span class="o">[</span>0.1217745989561081, <span class="s1">&#39;coyote&#39;</span><span class="o">]</span>, <span class="o">[</span>0.02413186803460121, <span class="s1">&#39;dingo&#39;</span><span class="o">]</span>, <span class="o">[</span>0.01603207364678383, <span class="s1">&#39;Eskimo dog&#39;</span><span class="o">]</span>, <span class="o">[</span>0.014261397533118725, <span class="s1">&#39;white wolf&#39;</span><span class="o">]</span>, <span class="o">[</span>0.011621303856372833, <span class="s1">&#39;malamute&#39;</span><span class="o">]</span>, <span class="o">[</span>0.005718537140637636, <span class="s1">&#39;dhole&#39;</span><span class="o">]</span>, <span class="o">[</span>0.005564256105571985, <span class="s1">&#39;Siberian husky&#39;</span><span class="o">]</span>, <span class="o">[</span>0.005237041972577572, <span class="s1">&#39;grey fox&#39;</span><span class="o">]</span>, <span class="o">[</span>0.003906863275915384, <span class="s1">&#39;Norwegian elkhound&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0017009602161124349, <span class="s1">&#39;red fox&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0016584355616942048, <span class="s1">&#39;dogsled&#39;</span><span class="o">]</span>, <span class="o">[</span>0.001648851903155446, <span class="s1">&#39;kit fox&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0015738625079393387, <span class="s1">&#39;German shepherd&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0014953723875805736, <span class="s1">&#39;African hunting dog&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0014643404865637422, <span class="s1">&#39;muzzle&#39;</span><span class="o">]</span>, <span class="o">[</span>0.001335897482931614, <span class="s1">&#39;great grey owl&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0012872095685452223, <span class="s1">&#39;bighorn&#39;</span><span class="o">]</span>, <span class="o">[</span>0.001251729903742671, <span class="s1">&#39;lynx&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0011842790991067886, <span class="s1">&#39;kelpie&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0011549243936315179, <span class="s1">&#39;tiger&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0011337717296555638, <span class="s1">&#39;impala&#39;</span><span class="o">]</span>, <span class="o">[</span>0.000954866292886436, <span class="s1">&#39;nematode&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0009288600995205343, <span class="s1">&#39;fur coat&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0009189517004415393, <span class="s1">&#39;sea slug&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0009050649823620915, <span class="s1">&#39;electric locomotive&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008787056431174278, <span class="s1">&#39;tennis ball&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008754126611165702, <span class="s1">&#39;ant&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008634432451799512, <span class="s1">&#39;flagpole&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008441561367362738, <span class="s1">&#39;cougar&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008401128579862416, <span class="s1">&#39;ram&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008386607514694333, <span class="s1">&#39;chiton&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008285755175165832, <span class="s1">&#39;hen-of-the-woods&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0008020748500712216, <span class="s1">&#39;tiger beetle&#39;</span><span class="o">]</span>, <span class="o">[</span>0.0007974817417562008, <span class="s1">&#39;macaw&#39;</span><span class="o">]</span>,......
</span></span></code></pre></div><h3 id="24-获取类别的-index">2.4 获取类别的 Index<a hidden class="anchor" aria-hidden="true" href="#24-获取类别的-index">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 加载 MobileNetV2 预训练模型</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">mobilenet_v2</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MobileNet_V2_Weights</span><span class="o">.</span><span class="n">IMAGENET1K_V2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 获取 ImageNet 类别映射</span>
</span></span><span class="line"><span class="cl"><span class="n">weights</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">MobileNet_V2_Weights</span><span class="o">.</span><span class="n">IMAGENET1K_V2</span>
</span></span><span class="line"><span class="cl"><span class="n">class_mapping</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&#34;categories&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查找特定类别的 ID</span>
</span></span><span class="line"><span class="cl"><span class="n">target_class1</span> <span class="o">=</span> <span class="s2">&#34;timber wolf&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="n">target_class2</span> <span class="o">=</span> <span class="s2">&#34;Granny Smith&#34;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_mapping</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">target_class1</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">class_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;找到类别 &#39;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">&#39; 的 ID: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">class_id</span> <span class="o">=</span> <span class="n">idx</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">target_class2</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">class_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;找到类别 &#39;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">&#39; 的 ID: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">class_id2</span> <span class="o">=</span> <span class="n">idx</span>
</span></span></code></pre></div><p>输出结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  granny python main.py
</span></span><span class="line"><span class="cl">找到类别 <span class="s1">&#39;timber wolf&#39;</span> 的 ID: <span class="m">269</span>
</span></span><span class="line"><span class="cl">找到类别 <span class="s1">&#39;Granny Smith&#39;</span> 的 ID: <span class="m">948</span>
</span></span></code></pre></div><h3 id="25-尝试匹配服务器设置的-mobilenetv2-预处理参数">2.5 尝试匹配服务器设置的 MobileNetV2 预处理参数<a hidden class="anchor" aria-hidden="true" href="#25-尝试匹配服务器设置的-mobilenetv2-预处理参数">#</a></h3>
<p>参考 Pytorch 官方的参数：https://pytorch.org/vision/main/models/generated/torchvision.models.mobilenet_v2.html</p>
<p>尝试了几个参数，发现 <code>resize_size = 256</code> <code>crop_size = 224</code> 的时候的训练结果最接近远程服务器的返回的结果。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># 使用预训练好的 MobileNetV2 模型进行测试</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torchvision.transforms</span> <span class="kn">import</span> <span class="n">InterpolationMode</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wolf_id</span> <span class="o">=</span> <span class="mi">269</span>
</span></span><span class="line"><span class="cl"><span class="n">apple_id</span> <span class="o">=</span> <span class="mi">948</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">image_path</span> <span class="o">=</span> <span class="s2">&#34;reference.png&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">mobilenet_v2</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MobileNet_V2_Weights</span><span class="o">.</span><span class="n">IMAGENET1K_V2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span> <span class="c1"># 设置模型为评估模式</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">preprocess</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">InterpolationMode</span><span class="o">.</span><span class="n">BILINEAR</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">transforms</span><span class="o">.</span><span class="n">CenterCrop</span><span class="p">(</span><span class="mi">224</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>  <span class="c1"># 自动将像素值缩放到[0.0, 1.0]</span>
</span></span><span class="line"><span class="cl">        <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                             <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">])</span>  
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&#34;RGB&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">input_tensor</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_batch</span> <span class="o">=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># 创建小批量数据</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 将输入数据传递给模型</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">probabilities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;timber wolf的概率为：&#34;</span><span class="p">,</span><span class="n">probabilities</span><span class="p">[</span><span class="n">wolf_id</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code>➜  granny python main.py
找到类别 &#39;timber wolf&#39; 的 ID: 269
找到类别 &#39;Granny Smith&#39; 的 ID: 948
timber wolf的概率为： 0.2857571542263031
</code></pre><h2 id="3-attack">3. Attack<a hidden class="anchor" aria-hidden="true" href="#3-attack">#</a></h2>
<h3 id="31-定义损失函数">3.1 定义损失函数<a hidden class="anchor" aria-hidden="true" href="#31-定义损失函数">#</a></h3>
<p>我们需要找到一个损失函数，使得图像的 Granny Smith 的概率变大，使 timber wolf 的概率变小，同时还不能使生成的对抗样本与原图像的汉明距离过大，于是我们定义损失函数为：</p>
<p>$$
Loss = Prob_{wolf} - Prob_{apple}
$$</p>
<h3 id="32-进行梯度下降">3.2 进行梯度下降<a hidden class="anchor" aria-hidden="true" href="#32-进行梯度下降">#</a></h3>
<p>这里调整阈值为 0.3，因为将 tensor 转换为 image 会导致概率下降。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">learning_rate</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">apple_prob</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">input_batch</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#启用图像的梯度计算</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span> <span class="c1">#训练前先清空梯度</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">wolf_id</span><span class="p">]</span> <span class="o">-</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">apple_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span> <span class="c1">#反向传播计算梯度</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">grad</span> <span class="o">=</span> <span class="n">input_batch</span><span class="o">.</span><span class="n">grad</span> <span class="c1">#获取梯度</span>
</span></span><span class="line"><span class="cl">        <span class="n">grad</span> <span class="o">=</span> <span class="n">grad</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span> <span class="c1">#对梯度进行归一化</span>
</span></span><span class="line"><span class="cl">        <span class="n">input_batch</span> <span class="o">=</span> <span class="n">input_batch</span> <span class="o">-</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">grad</span> <span class="c1">#梯度下降</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">apple_prob</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="n">apple_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Granny Smith的概率：&#34;</span><span class="p">,</span><span class="n">apple_prob</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">wolf_prob</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="n">wolf_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;timber wolf的概率：&#34;</span><span class="p">,</span><span class="n">wolf_prob</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">apple_prob</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span> <span class="c1">#当 Granny Smith 的概率高于 0.3 时 break</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code>➜  granny python main.py
Granny Smith的概率： 0.0006618537590838969
timber wolf的概率： 0.2857571542263031
Granny Smith的概率： 0.0015279407380148768
timber wolf的概率： 0.09206391870975494
Granny Smith的概率： 0.002136402763426304
timber wolf的概率： 0.028267469257116318
Granny Smith的概率： 0.00256370403803885
timber wolf的概率： 0.011457344517111778
Granny Smith的概率： 0.0030766830313950777
timber wolf的概率： 0.005836689844727516
Granny Smith的概率： 0.0038345830980688334
timber wolf的概率： 0.0038260468281805515
Granny Smith的概率： 0.004675824660807848
timber wolf的概率： 0.0026970321778208017
Granny Smith的概率： 0.005650049541145563
timber wolf的概率： 0.0018584068166092038
Granny Smith的概率： 0.007557385601103306
timber wolf的概率： 0.0013900937046855688
Granny Smith的概率： 0.010187835432589054
timber wolf的概率： 0.001048899837769568
Granny Smith的概率： 0.01829897239804268
timber wolf的概率： 0.0008268445380963385
Granny Smith的概率： 0.030838338658213615
timber wolf的概率： 0.0006287696305662394
Granny Smith的概率： 0.051031142473220825
timber wolf的概率： 0.0005385194672271609
Granny Smith的概率： 0.0682976171374321
timber wolf的概率： 0.00044211061322130263
Granny Smith的概率： 0.12347796559333801
timber wolf的概率： 0.00035081306123174727
Granny Smith的概率： 0.20108601450920105
timber wolf的概率： 0.00025084661319851875
Granny Smith的概率： 0.28898271918296814
timber wolf的概率： 0.00020292497356422246
Granny Smith的概率： 0.3443906307220459
timber wolf的概率： 0.0001684601156739518
</code></pre><h3 id="33-将-tensor-转换为-image">3.3 将 tensor 转换为 image<a hidden class="anchor" aria-hidden="true" href="#33-将-tensor-转换为-image">#</a></h3>
<p>将 <code>224 × 244</code> 大小的 tensor 转换为 <code>256 × 256</code>，可以尽量避免图像转换造成的概率值变化。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">from_tensor_to_image</span><span class="p">(</span><span class="n">t_image</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">np_image</span> <span class="o">=</span> <span class="n">t_image</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">MEAN</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">STD</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">pad_width</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span> <span class="o">-</span> <span class="mi">224</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="p">(</span><span class="n">np_image</span><span class="o">*</span><span class="n">STD</span> <span class="o">+</span> <span class="n">MEAN</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">padding</span> <span class="o">=</span> <span class="p">((</span><span class="n">pad_width</span><span class="p">,</span> <span class="n">pad_width</span><span class="p">),</span> <span class="p">(</span><span class="n">pad_width</span><span class="p">,</span> <span class="n">pad_width</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="c1"># 填充边界</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># 从数组创建图像</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">image</span> 
</span></span></code></pre></div><p>得到 <code>AE.png</code></p>
<img src="https://s2.loli.net/2025/03/11/SmDup4Ia98b3hJ6.png"  />
<h3 id="34-测试-ae-的概率">3.4 测试 AE 的概率<a hidden class="anchor" aria-hidden="true" href="#34-测试-ae-的概率">#</a></h3>
<p>将得到的 <code>AE.png</code> 通过 <code>MobileNetV2</code> 进行测试：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">adversarial_image</span> <span class="o">=</span> <span class="n">from_tensor_to_image</span><span class="p">(</span><span class="n">input_batch</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">adversarial_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&#34;AE.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">AE_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;AE.png&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&#34;RGB&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 测试对抗样本</span>
</span></span><span class="line"><span class="cl"><span class="n">input_tensor</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">AE_image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_batch</span> <span class="o">=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Create a mini-batch as expected by the model</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">probabilities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Wolf probability:&#34;</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">[</span><span class="n">wolf_id</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Apple probability:&#34;</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">[</span><span class="n">apple_id</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code>➜  granny python main.py
Wolf probability: 0.00037845675251446664
Apple probability: 0.15955209732055664
</code></pre><p>可以看到识别为 Wolf 的概率已经很小了，但识别为苹果的概率达到了 0.159</p>
<h2 id="4-submit">4. Submit<a hidden class="anchor" aria-hidden="true" href="#4-submit">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># 提交flag</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">submit_flag</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">CRUCIBLE_URL</span><span class="si">}</span><span class="s2">/api/challenges/</span><span class="si">{</span><span class="n">CHALLENGE</span><span class="si">}</span><span class="s2">/submit-flag&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;X-API-Key&#34;</span><span class="p">:</span> <span class="n">CRUCIBLE_API_KEY</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;challenge&#34;</span><span class="p">:</span> <span class="n">CHALLENGE</span><span class="p">,</span> <span class="s2">&#34;flag&#34;</span><span class="p">:</span> <span class="n">flag</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;correct&#34;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The flag was correct. Congrats!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The flag was incorrect. Keep trying!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There was an error submitting your flag&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;AE.png&#34;</span><span class="p">,</span> <span class="s2">&#34;rb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">AE</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="n">AE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">FLAG</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">submit_flag</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span>
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code>➜  granny python main.py
gAAAAABnz6uSFsd9S9eDRbtJrVsWAnu_HdAQyheTFj9dhrpFPnvGGa6KQBdYM2iJhlj6oz9T3bz7InE_ci0VZBmUFKUgE4plqWu_j8ysrWqdPQfs6iYMG7a2YJNlhWM4Aiw6fTcV01Giw7UuNq43SceKOWJzmw-dqA98weZi7EQj0Gjj_XlcxkSpA2WSsd5r55Pp6E-11iK3
The flag was correct. Congrats!
</code></pre><img src="https://s2.loli.net/2025/03/11/oh8KGQMIumO2JDW.png" style="zoom:67%;" />


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://smera1d0.github.io/tags/ai%E5%AE%89%E5%85%A8/">AI安全</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://smera1d0.github.io/posts/leetcode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/">
    <span class="title">« 上一页</span>
    <br>
    <span>Leetcode每日一题</span>
  </a>
  <a class="next" href="https://smera1d0.github.io/posts/%E4%BF%A1%E6%81%AF%E8%AE%BA%E5%9F%BA%E7%A1%80/">
    <span class="title">下一页 »</span>
    <br>
    <span>信息论基础</span>
  </a>
</nav>

  </footer><script src="https://giscus.app/client.js"
        data-repo="Smera1d0/Smera1d0.github.io"
        data-repo-id="R_kgDOIXSe_Q"
        data-category="Announcements"
        data-category-id="DIC_kwDOIXSe_c4CmMtR"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
    <span>© <a href="https://github.com/adityatelange/hugo-PaperMod/graphs/contributors">PaperMod Contributors</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>


<script>
    window.difyChatbotConfig = {
     token: 'htsETvzQ7fBTQ9CN',
     systemVariables: {
       
     },
    }
   </script>
   <script
    src="https://udify.app/embed.min.js"
    id="htsETvzQ7fBTQ9CN"
    defer>
   </script>
<style>
     
    #dify-chatbot-bubble-button {
      background-color: #1C64F2 !important;
      position: fixed !important;
      bottom: 80px !important;
      right: 20px !important;
      z-index: 1000 !important;
      width: 3rem !important;  
      height: 3rem !important;  
      border-radius: 50% !important;  
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    #dify-chatbot-bubble-window {
      width: 25rem !important;
      height: 45rem !important;
      position: fixed !important;
      bottom: 80px !important;
      right: 20px !important;
      z-index: 1000 !important;
    }
    
     
    .top-link {
      position: fixed !important;
      bottom: 20px !important;  
      right: 20px !important; 
      z-index: 999 !important;
      width: 3rem !important; 
      height: 3rem !important;
    }
</style>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

<style>
     
    html body #dify-chatbot-bubble-button {
      background-color: #1C64F2 !important;
      position: fixed !important;
      bottom: 80px !important;
      right: 20px !important;
      z-index: 1000 !important;
      width: 3rem !important;  
      height: 3rem !important;  
      border-radius: 50% !important;  
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    html body #dify-chatbot-bubble-window {
      width: 25rem !important;
      height: 45rem !important;
      position: fixed !important;
      bottom: 80px !important;
      right: 20px !important;
      z-index: 1000 !important;
    }
    
     
    html body .top-link {
      position: fixed !important;
      bottom: 20px !important;  
      right: 20px !important; 
      z-index: 999 !important;
      width: 3rem !important; 
      height: 3rem !important;
    }
</style>

</html>
